(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{9379:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"create-task q-pa-md",staticStyle:{"max-width":"400px"}},[s("q-form",{staticClass:"q-gutter-md",on:{submit:e.onSubmit,reset:e.onReset}},[s("q-input",{attrs:{filled:"",label:"Название задачи: *","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Поле не может быть пустым"}]},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),s("q-input",{attrs:{filled:"",label:"Описание:"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),s("q-select",{attrs:{filled:"",options:e.getProjectsName(),label:"Добавить в проект:"},model:{value:e.projectMember,callback:function(t){e.projectMember=t},expression:"projectMember"}}),s("q-select",{attrs:{filled:"",options:e.getDepartments(),label:"Отправить в отдел:"},on:{input:function(t){e.memberList=[]}},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}}),s("q-input",{attrs:{filled:"",type:"number",label:"Приоритет:","lazy-rules":"",min:"0",max:"10",rules:[function(e){return e<11||"Приоритет варьируется от 0 до 10, по умолчанию 0"}]},model:{value:e.priority,callback:function(t){e.priority=t},expression:"priority"}}),s("q-btn",{on:{click:function(t){e.isMemberSelectionOpened=!e.isMemberSelectionOpened}}},[e._v("Выбор состава задачи")]),s("q-dialog",{attrs:{"transition-show":"fade","transition-hide":"fade","full-width":""},model:{value:e.isMemberSelectionOpened,callback:function(t){e.isMemberSelectionOpened=t},expression:"isMemberSelectionOpened"}},[s("q-card",{staticClass:"flex column no-wrap q-pa-lg",staticStyle:{height:"50vh"}},[s("UserSelection",{attrs:{type:"task_create",users:e.filteredUserList()},on:{memberList:e.fillMemberList}})],1)],1),this.memberList.length?s("div",[s("q-list",{attrs:{bordered:""}},e._l(this.memberList,(function(t,i){return s("q-item",{key:"member_i"+i},[e._v("\n                    "+e._s(t.fullName)+" ( "+e._s(t.isHead?"Рук.":null)+" "+e._s(t.isMaster?"Отв.":null)+" "+e._s(t.isPerformer?"Исп.":null)+" "+e._s(t.isMember?"Уч-к.":null)+" )\n                ")])})),1)],1):e._e(),s("q-input",{attrs:{filled:"",label:"Срок сдачи:"},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[s("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[s("q-date",{attrs:{mask:"YYYY-MM-DD HH:mm"},model:{value:e.expDate,callback:function(t){e.expDate=t},expression:"expDate"}},[s("div",{staticClass:"row items-center justify-end"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0},{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"access_time"}},[s("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[s("q-time",{attrs:{mask:"YYYY-MM-DD HH:mm",format24h:""},model:{value:e.expDate,callback:function(t){e.expDate=t},expression:"expDate"}},[s("div",{staticClass:"row items-center justify-end"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.expDate,callback:function(t){e.expDate=t},expression:"expDate"}}),s("q-toggle",{attrs:{label:"Поставьте галочку, если уверены в правильности введенных данных"},model:{value:e.submit,callback:function(t){e.submit=t},expression:"submit"}}),s("div",[s("q-btn",{attrs:{label:"Подтвердить",type:"submit",color:"primary"}}),s("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Отменить",type:"reset",color:"primary",flat:""}})],1)],1)],1)},r=[],l=(s("ddb0"),s("e01a"),s("2f62")),n=s("d21d"),a={components:{UserSelection:n["a"]},data(){return{title:"",description:"Без описания",members:null,performers:null,master:null,projectMember:"Без привязки к проекту",priority:0,expDate:"Не выбрано",department:"Без привязки к отделу",submit:!0,isMemberSelectionOpened:!1,memberList:[]}},methods:{...Object(l["b"])("task",["CREATE_TASK"]),fillMemberList(e){this.memberList=e,this.isMemberSelectionOpened=!1},filteredUserList(){return"Без привязки к отделу"!==this.department?this.userList.filter((e=>e.department.title===this.department)):this.userList},getDepartments(){let e=[];return this.departmentList.forEach((t=>{t.heads.length&&e.push(t.title)})),["Без привязки к отделу",...e]},getProjectsName(){let e=[];return this.projectList.forEach((t=>{e.push(t.title)})),e},onSubmit(){if(!0!==this.submit)this.$q.notify({color:"red-5",textColor:"white",icon:"warning",message:"Вы должны подтвердить правильность введенных данных !"});else{let e=[],t=[],s=null;this.memberList.forEach((i=>{i.isMember&&e.push({_id:i._id}),i.isPerformer&&t.push({_id:i._id}),i.isMaster&&(s={_id:i._id})})),this.CREATE_TASK({title:this.title,description:this.description,members:e.length?e:null,performers:t.length?t:null,master:null!==s?s:null,projectMember:"Без привязки к проекту"===this.projectMember?null:this.projectMember,priority:parseInt(this.priority,10),department:this.department,expDate:"Не выбрано"===this.expDate?null:this.expDate,created:new Date,createdBy:{_id:this.activeUser._id,fullName:this.activeUser.fullName}}),this.onReset()}},onReset(){this.title=null,this.description=null,this.submit=!1,this.memberList=[]}},computed:{...Object(l["c"])("user",["userList","activeUser"]),...Object(l["c"])("project",["projectList"]),...Object(l["c"])("department",["departmentList"])}},o=a,c=s("2877"),p=Object(c["a"])(o,i,r,!1,null,null,null);t["default"]=p.exports}}]);